<!-- Songs Modal -->
<div id="songs-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 hidden">
    <div class="bg-zinc-900/50 backdrop-blur-xs border border-zinc-700 rounded-lg w-full max-w-2xl mx-4 max-h-[90vh] flex flex-col shadow-2xl">
        <!-- Fixed Header -->
        <div class="flex justify-between items-center p-4 border-b border-zinc-700 flex-shrink-0 relative w-full">
            <div class="flex justify-between items-center relative w-full">
                <!-- Back button (left) -->
                <button id="back-to-songs-list-btn" class="text-zinc-400 hover:text-white transition-colors hidden absolute left-0">
                    <span class="material-icons">arrow_back</span>
                </button>
                
                <!-- Title (center) -->
                <h3 class="text-lg font-semibold text-white flex items-center gap-2 mx-auto">
                    <span class="material-icons text-emerald-400">library_music</span>
                    <span id="songs-modal-title">Song Manager</span>
                </h3>
                
                <!-- Close button (right) -->
                <button id="close-songs-modal" class="text-zinc-400 hover:text-white transition-colors flex absolute right-0">
                    <span class="material-icons">close</span>
                </button>
            </div>
        </div>

        <!-- Scrollable Content -->
        <div class="flex-1 overflow-y-auto p-4">
            <!-- Song List View -->
            <div id="songs-list-view">
                <div class="mb-4 flex justify-between items-center">
                    <p class="text-sm text-zinc-400">Manage custom songs for Billy to perform</p>
                    <button id="create-song-btn"
                            class="bg-emerald-600 hover:bg-emerald-500 transition-colors text-white text-sm py-2 px-4 rounded flex gap-2 items-center">
                        <span class="material-icons text-sm">add</span>
                        New Song
                    </button>
                </div>

                <!-- Songs Grid -->
                <div id="songs-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Songs will be inserted here by JS -->
                </div>

                <!-- Empty State -->
                <div id="songs-empty-state" class="hidden text-center py-12">
                    <span class="material-icons text-6xl text-zinc-600 mb-4">music_off</span>
                    <p class="text-zinc-400 mb-4">No custom songs yet</p>
                    <button class="bg-emerald-600 hover:bg-emerald-500 transition-colors text-white text-sm py-2 px-4 rounded"
                            onclick="document.getElementById('create-song-btn').click()">
                        Create Your First Song
                    </button>
                </div>
            </div>

            <!-- Song Edit View -->
            <div id="song-edit-view" class="hidden">
                <form id="song-edit-form" class="space-y-6">
                    <!-- Song Name (for new songs only) -->
                    <div id="song-name-field">
                        <label for="song-name" class="block text-sm font-semibold text-slate-300 mb-2">
                            Song Name (folder name)
                        </label>
                        <input type="text" id="song-name" name="name"
                               class="w-full px-3 py-2 bg-zinc-800 border border-zinc-700 rounded text-white"
                               placeholder="e.g., my_awesome_song"
                               pattern="[a-z0-9_]+"
                               title="Only lowercase letters, numbers, and underscores">
                        <p class="text-xs text-zinc-500 mt-1">Only lowercase letters, numbers, and underscores</p>
                    </div>

                    <!-- Title -->
                    <div>
                        <label for="song-title" class="block text-sm font-semibold text-slate-300 mb-2">
                            Display Title
                        </label>
                        <input type="text" id="song-title" name="title"
                               class="w-full px-3 py-2 bg-zinc-800 border border-zinc-700 rounded text-white"
                               placeholder="e.g., My Awesome Song"
                               required>
                    </div>

                    <!-- Keywords -->
                    <div>
                        <label for="song-keywords" class="flex justify-between items-center font-semibold text-sm text-slate-300">
                            Keywords (comma-separated)
                            <span class="material-icons align-middle hover:text-cyan-400 cursor-pointer"
                                  onclick="toggleTooltip(this)">help_outline</span>
                        </label>
                        <div class="relative">
                            <div data-tooltip>
                                Keywords help Billy understand when to play this song.<br>
                                Include song title, artist name, genre, mood, or themes.<br><br>
                                <b>Examples:</b><br>
                                • "happy birthday, celebration, party"<br>
                                • "rock, guitar, upbeat, energetic"<br>
                                • "relaxing, calm, peaceful, chill"
                            </div>
                            <input type="text" id="song-keywords" name="keywords"
                                   class="w-full px-3 py-2 mt-1 bg-zinc-800 border border-zinc-700 rounded text-white"
                                   placeholder="e.g., rock, guitar, upbeat">
                        </div>
                    </div>

                    <!-- Audio Files -->
                    <div class="space-y-4">
                        <label class="flex justify-between items-center font-semibold text-sm text-slate-300">
                            <span class="flex items-center gap-2">
                                <span class="material-icons text-sm">audiotrack</span>
                                Audio Files
                            </span>
                            <span class="material-icons align-middle hover:text-cyan-400 cursor-pointer"
                                  onclick="toggleTooltip(this)">help_outline</span>
                        </label>
                        <div class="relative">
                            <div data-tooltip>
                                <b>How to prepare audio files:</b><br><br>
                                <b>1. Full Mix (full.wav):</b> The complete song as Billy will play it<br>
                                <b>2. Vocals (vocals.wav):</b> Isolated vocals for mouth sync<br>
                                <b>3. Drums (drums.wav):</b> Isolated drums/percussion for tail movements<br><br>
                                <b>Splitting audio:</b> Use <a href="https://vocalremover.org/" target="_blank" class="underline hover:text-cyan-400">Vocal Remover and Isolation</a>, Spleeter, Demucs, or LALAL.AI to separate stems.<br><br>
                                <b>Technical requirements:</b><br>
                                • Format: WAV (uncompressed)<br>
                                • Sample rate: 48 kHz<br>
                                • Bit depth: 16-bit<br>
                                • All three files must have the same length
                            </div>
                        </div>

                        <!-- Full Audio -->
                        <div class="bg-zinc-800/50 p-4 rounded border border-zinc-700">
                            <div class="flex items-center justify-between">
                                <label class="text-sm font-medium text-zinc-300">
                                    Full Mix (full.wav)
                                    <span id="full-status" class="ml-2"></span>
                                </label>
                                <div class="flex items-center gap-2">
                                    <label for="full-file" class="text-zinc-400 hover:text-emerald-400 transition-colors cursor-pointer" title="Upload file">
                                        <span class="material-icons">upload</span>
                                    </label>
                                    <button type="button" id="play-full" class="text-zinc-400 hover:text-emerald-400 transition-colors hidden" title="Play/Pause">
                                        <span class="material-icons">play_circle</span>
                                    </button>
                                    <input type="file" id="full-file" accept=".wav" class="hidden">
                                </div>
                            </div>
                            <audio id="full-audio" class="hidden"></audio>
                        </div>

                        <!-- Vocals -->
                        <div class="bg-zinc-800/50 p-4 rounded border border-zinc-700">
                            <div class="flex items-center justify-between">
                                <label class="text-sm font-medium text-zinc-300">
                                    Vocals (vocals.wav) - for mouth movements
                                    <span id="vocals-status" class="ml-2"></span>
                                </label>
                                <div class="flex items-center gap-2">
                                    <label for="vocals-file" class="text-zinc-400 hover:text-emerald-400 transition-colors cursor-pointer" title="Upload file">
                                        <span class="material-icons">upload</span>
                                    </label>
                                    <button type="button" id="play-vocals" class="text-zinc-400 hover:text-emerald-400 transition-colors hidden" title="Play/Pause">
                                        <span class="material-icons">play_circle</span>
                                    </button>
                                    <input type="file" id="vocals-file" accept=".wav" class="hidden">
                                </div>
                            </div>
                            <audio id="vocals-audio" class="hidden"></audio>
                        </div>

                        <!-- Drums -->
                        <div class="bg-zinc-800/50 p-4 rounded border border-zinc-700">
                            <div class="flex items-center justify-between">
                                <label class="text-sm font-medium text-zinc-300">
                                    Drums (drums.wav) - for tail movements
                                    <span id="drums-status" class="ml-2"></span>
                                </label>
                                <div class="flex items-center gap-2">
                                    <label for="drums-file" class="text-zinc-400 hover:text-emerald-400 transition-colors cursor-pointer" title="Upload file">
                                        <span class="material-icons">upload</span>
                                    </label>
                                    <button type="button" id="play-drums" class="text-zinc-400 hover:text-emerald-400 transition-colors hidden" title="Play/Pause">
                                        <span class="material-icons">play_circle</span>
                                    </button>
                                    <input type="file" id="drums-file" accept=".wav" class="hidden">
                                </div>
                            </div>
                            <audio id="drums-audio" class="hidden"></audio>
                        </div>
                    </div>

                    <!-- Song Settings -->
                    <div class="space-y-4">
                        <h4 class="text-sm font-semibold text-slate-300 flex items-center gap-2">
                            <span class="material-icons text-sm">tune</span>
                            Animation Settings
                        </h4>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- BPM -->
                            <div>
                                <label for="song-bpm" class="block text-sm font-medium text-zinc-300 mb-2">
                                    BPM (Beats Per Minute)
                                </label>
                                <input type="number" id="song-bpm" name="bpm"
                                       class="w-full px-3 py-2 bg-zinc-800 border border-zinc-700 rounded text-white"
                                       value="120" min="40" max="200" step="0.1">
                            </div>

                            <!-- Gain -->
                            <div>
                                <label for="song-gain" class="flex justify-between items-center font-semibold text-sm text-slate-300">
                                    Gain (Volume Multiplier)
                                    <span class="material-icons align-middle hover:text-cyan-400 cursor-pointer"
                                          onclick="toggleTooltip(this)">help_outline</span>
                                </label>
                                <div class="relative">
                                    <div data-tooltip>
                                        Adjusts the song volume relative to Billy's speech.<br>
                                        <b>1.0:</b> Original volume (default)<br>
                                        <b>&lt; 1.0:</b> Quieter than original<br>
                                        <b>&gt; 1.0:</b> Louder than original<br><br>
                                        Increase this if your song is quieter than Billy's voice.
                                    </div>
                                    <input type="number" id="song-gain" name="gain"
                                           class="w-full px-3 py-2 mt-1 bg-zinc-800 border border-zinc-700 rounded text-white"
                                           value="1.0" min="0.1" max="5.0" step="0.1">
                                </div>
                            </div>

                            <!-- Tail Threshold -->
                            <div>
                                <label for="song-tail-threshold" class="flex justify-between items-center font-semibold text-sm text-slate-300">
                                    Tail Threshold
                                    <span class="material-icons align-middle hover:text-cyan-400 cursor-pointer"
                                          onclick="toggleTooltip(this)">help_outline</span>
                                </label>
                                <div class="relative">
                                    <div data-tooltip>
                                        Minimum drum amplitude required to trigger tail movement.<br>
                                        <b>Lower values:</b> More sensitive, tail moves more often<br>
                                        <b>Higher values:</b> Less sensitive, only strong beats move tail
                                    </div>
                                    <input type="number" id="song-tail-threshold" name="tail_threshold"
                                           class="w-full px-3 py-2 mt-1 bg-zinc-800 border border-zinc-700 rounded text-white"
                                           value="1500" min="0" max="10000" step="100">
                                </div>
                            </div>

                            <!-- Compensate Tail -->
                            <div>
                                <label for="song-compensate-tail" class="flex justify-between items-center font-semibold text-sm text-slate-300">
                                    Compensate Tail (0-1)
                                    <span class="material-icons align-middle hover:text-cyan-400 cursor-pointer"
                                          onclick="toggleTooltip(this)">help_outline</span>
                                </label>
                                <div class="relative">
                                    <div data-tooltip>
                                        Delays tail movement by a fraction of the beat length to compensate for timing differences.<br>
                                        <b>0:</b> No compensation, immediate response<br>
                                        <b>0.25:</b> Quarter beat delay<br>
                                        <b>0.5:</b> Half beat delay<br>
                                        <b>1:</b> Full beat delay
                                    </div>
                                    <input type="number" id="song-compensate-tail" name="compensate_tail"
                                           class="w-full px-3 py-2 mt-1 bg-zinc-800 border border-zinc-700 rounded text-white"
                                           value="0" min="0" max="1" step="0.05">
                                </div>
                            </div>
                        </div>

                        <!-- Head Moves -->
                        <div>
                            <label for="song-head-moves" class="flex justify-between items-center font-semibold text-sm text-slate-300 mb-2">
                                Head Moves (time:duration pairs)
                                <span class="material-icons align-middle hover:text-cyan-400 cursor-pointer ml-1"
                                      onclick="toggleTooltip(this)">help_outline</span>
                            </label>
                            <div class="relative">
                                <div data-tooltip class="w-64">
                                    Format: time_in_seconds:duration, comma-separated<br>
                                    Example: 2:2.0, 29.5:2.0, 33:2.0
                                </div>
                                <input type="text" id="song-head-moves" name="head_moves"
                                       class="w-full px-3 py-2 bg-zinc-800 border border-zinc-700 rounded text-white"
                                       placeholder="e.g., 2:2.0, 29.5:2.0, 33:2.0">
                            </div>
                        </div>

                        <!-- Half Tempo Tail Flap -->
                        <div>
                            <label for="song-half-tempo" class="flex justify-between items-center font-semibold text-sm text-slate-300">
                                Half Tempo Tail Flap
                                <span class="material-icons align-middle hover:text-cyan-400 cursor-pointer"
                                      onclick="toggleTooltip(this)">help_outline</span>
                            </label>
                            <div class="relative">
                                <div data-tooltip>
                                    Makes the tail flap at half the tempo of the beat.<br>
                                    Useful for slower, more deliberate tail movements in fast songs.
                                </div>
                                <div class="flex items-center gap-2 mt-1">
                                    <input type="checkbox" id="song-half-tempo" name="half_tempo_tail_flap"
                                           class="w-4 h-4 bg-zinc-800 border-zinc-700 rounded text-emerald-600 focus:ring-emerald-500">
                                    <span class="text-sm text-zinc-400">Enable half-tempo tail movement</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Fixed Footer -->
        <div id="song-edit-footer" class="hidden border-t border-zinc-700 p-4 flex-shrink-0 flex justify-between items-center">
            <button id="delete-song-btn" type="button"
                    class="bg-rose-600 hover:bg-rose-500 transition-colors text-white text-sm py-2 px-4 rounded flex gap-2 items-center">
                <span class="material-icons text-sm">delete</span>
                Delete Song
            </button>
            <button id="save-song-btn" type="button"
                    class="bg-emerald-600 hover:bg-emerald-500 transition-colors text-white text-sm py-2 px-4 rounded flex gap-2 items-center">
                <span class="material-icons text-sm">save</span>
                <span id="save-song-btn-text">Save Song</span>
            </button>
        </div>
    </div>
</div>

